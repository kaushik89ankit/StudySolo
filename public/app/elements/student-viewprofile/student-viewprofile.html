<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<dom-module id="student-viewprofile">
    <template>
        <style>
        :host {}
        
        paper-card {
            background-color: white;
            color: #000000;
            width: 98%;
            margin: 5px;
        }
        
        paper-item.simple {
            pointer-events: none;
        }
        
        paper-button {
            margin: 5px;
            width: 45%;
            background: #006622;
            color: #ffffff;
        }
        
        paper-checkbox {
            margin-top: 20px;
            --paper-checkbox-checked-color: var(--paper-green-500);
            --paper-checkbox-checked-ink-color: var(--paper-green-500);
            --paper-checkbox-unchecked-color: var(--paper-green-900);
            --paper-checkbox-unchecked-ink-color: var(--paper-green-900);
            --paper-checkbox-label-color: #004d1a;
        }
        
        .heading {
            background-color: #009933;
            text-align: center;
            color: #ffffff;
            height: 50px;
            padding: 10px;
        }
        
        .big {
            --iron-icon-height: 30px;
            --iron-icon-width: 30px;
            padding-right: 20px;
        }
        
        .error {
            color: red;
        }
        
        .centercontainer {
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
        }
        
        paper-dialog {
            color: black;
            padding: -10px;
        }
        
        paper-button.indigo {
            background-color: var(--paper-indigo-500);
            color: white;
            margin-top: 10px;
            --paper-button-raised-keyboard-focus: {
                color: white !important;
                margin-left: 10px;
            }
            ;
        }
        
        paper-button.indigo:hover {
            background-color: var(--paper-indigo-100);
        }
        
        .labelClass {
            margin: 5px;
        }
        
        .address #detail1 {
            width: 28%;
            padding: 5px;
            margin-left: 17%;
            margin-top: -3%;
        }
        
        .address #detail2 {
            width: 30%;
            padding: 5px;
            margin-left: 5%;
            margin-top: -3%;
        }
        
        .address #email {
            width: 30%;
            padding: 5px;
            margin-left: 5%;
            margin-top: -3%;
        }
        
        .details2in1,
        .school_about {
            @apply(--layout-horizontal);
            margin-top: 10px;
        }
        
        .school_about #school {
            width: 40%;
            padding: 5px;
            margin-left: 18%;
            margin-top: -3%;
            margin-bottom: 1%;
        }
        
        .school_about #stream {
            width: 10%;
            padding: 5px;
            margin-left: 1%;
            margin-top: -3%;
            margin-bottom: 1%;
        }
        
        .school_about #class {
            width: 10%;
            padding: 5px;
            margin-left: 1%;
            margin-top: -3%;
            margin-bottom: 1%;
        }
        
        .aboutme #aboutme {
            width: 65%;
            padding: 5px;
            margin-left: 17%;
            margin-top: -4%;
        }
        
        .rowStyle {
            @apply(--layout-horizontal);
            font-size: 18px;
            padding: 0.5em;
        }
        
        .title {
            font-weight: bold;
            margin-right: 0.5em;
            color: #9b6b69;
        }
        
        .okButton {
            background-color: var(--button-normal);
            color: var(--color-white);
        }
        
        .okButton:hover {
            background-color: var(--button-hover);
        }
        </style>
        <paper-card elevation="2">
            <div class="horizontal layout" style="width:98%; height:30px;color:black; padding:10px; background:#E9EAED;">
                <h2 id="studentProfileHeading" style="margin-top:2px;"> My Profile </h2>
                <paper-icon-button icon="icons:create" style="color:#4E7AC7; margin-top:0px; padding-top:0;" on-click="openEditProfile"></paper-icon-button>
            </div>
            <div class="card-content">
                <div class="horizontal layout">
                    <h3>Account Details</h3>
                    <h4 style="margin-left:5px;">(Provided by Institute)</h4>
                </div>
                <div class="vertical layout">
                    <div class="rowStyle">
                        <div class="title" style="margin-left: 9em;">User Id: </div>
                        <span style="word-wrap: break-word;">{{loginid}}</span>
                    </div>
                    <div class="horizontal layout">
                        <div class="rowStyle">
                            <div class="title" style="margin-left: 9em;">Batch Id: </div>
                            <span>{{batchid}}</span>
                        </div>
                        <div class="rowStyle">
                            <div class="title" style=" margin-left: 1em;">Batch Name: </div>
                            <span>{{batchname}}</span>
                        </div>
                    </div>
                </div>
                <hr>
                <div>
                    <h3>Personal Details</h3>
                </div>
                <div class="horizontal layout" style="margin-bottom: 30px;">
                    <iron-image id="profilepicupload" src={{imageurl}} style="width:150px; height:150px; border:1px solid #3F51B5; margin-left: 10em; cursor: pointer;" sizing="contain" on-click="openImage"></iron-image>
                    <div class="vertical layout">
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 2em;">
                            <div class="title">Name: </div>
                            <span>{{fullname}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 2em;">
                            <div class="title">Gender: </div>
                            <span>{{gender}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 2em;">
                            <div class="title">Date Of Birth: </div>
                            <span>{{dob}}</span>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="aboutme">
                    <h3>About Me</h3>
                    <div style=" margin-left: 12em;">{{aboutme}}</div>
                </div>
                <br>
                <hr>
                <div class="address">
                    <h3>Contact Info</h3>
                    <div class="rowStyle" style="margin-top: 0.5em; margin-left: 10em;">
                        <div class="title">Address: </div>
                        <span>{{address}}</span>
                    </div>
                    <div class="layout horizontal">
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 10em; width:30%;">
                            <div class="title">City: </div>
                            <span>{{city}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em;">
                            <div class="title">District: </div>
                            <span>{{district}}</span>
                        </div>
                    </div>
                    <div class="layout horizontal">
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 10em; width:30%;">
                            <div class="title">State: </div>
                            <span>{{state}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em;">
                            <div class="title">Country: </div>
                            <span>{{country}}</span>
                        </div>
                    </div>
                    <div class="layout horizontal">
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 10em; width:30%;">
                            <div class="title">Pincode: </div>
                            <span>{{pincode}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em;">
                            <div class="title">Email: </div>
                            <span>{{email}}</span>
                        </div>
                    </div>
                    <div class="layout horizontal">
                        <div class="rowStyle" style="margin-top: 0.5em; margin-left: 10em; width:30%;">
                            <div class="title">Mobile: </div>
                            <span>{{mobile}}</span>
                        </div>
                        <div class="rowStyle" style="margin-top: 0.5em;">
                            <div class="title">Landline: </div>
                            <span>{{landline}}</span>
                        </div>
                    </div>
                </div>
                <br>
                <hr>
                <div class="school">
                    <h3>Education</h3>
                    <div class="layout horizontal ">
                        <div class="rowStyle" style="width:30%;">
                            <div class="title" style=" margin-left: 10em;">Class: </div>
                            <span>{{studClass}}</span>
                        </div>
                        <div class="rowStyle">
                            <div class="title">School: </div>
                            <span>{{schoolname}}</span>
                        </div>
                    </div>
                </div>
                <br>
            </div>
        </paper-card>
        <paper-dialog id="errorDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
            <h2 class="error">Error</h2>
            <p>{{error}}</p>
            <div class="centercontainer">
                <paper-button class="errorbutton" dialog-dismiss>OK</paper-button>
            </div>
        </paper-dialog>
        <paper-dialog id="image_dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
            <iron-image style="width:400px; height:400px;" src={{imageurl}} sizing="contain"></iron-image>
        </paper-dialog>
        <!-- Paper Dialogs ends here -->
        <!-- ajax call  starts here-->
        <!-- For posting the student data starts here -->
        <iron-ajax id="updatestudent_ironajax" url="/api/students/update" handle-as="json" content-type='application/json' params="{{studentupdate_Params}}" method="POST" body="{{updatestudent_postbody}}" on-response="updateStudentOnResponse" on-error="updateStudentOnError"></iron-ajax>
        <!-- For posting the student data ends here -->
        <!-- For getting student profile details starts here -->
        <iron-ajax id="studentget_ironajax" url="/api/students" handle-as="json" content-type='application/json' params="{{studentget_Params}}" method="GET" on-response="getStudentOnResponse" on-error="getStudentOnError"></iron-ajax>
        <!-- For getting student profile details ends here -->
        <!-- ajax call ends here -->
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'student-viewprofile',

            properties: {
                loginid: {
                    type: String,
                    value: '',
                    notify: true
                },
                batchid: {
                    type: String,
                    value: '',
                    notify: true
                },
                batchname: {
                    type: String,
                    value: '',
                    notify: true
                },
                fname: {
                    type: String,
                    notify: true
                },
                mname: {
                    type: String,
                    notify: true
                },
                lname: {
                    type: String,
                    notify: true
                },
                fullname: {
                    type: String,
                    notify: true
                },
                imageurl: {
                    type: String,
                    value: '',
                    notify: true
                },
                pickerDate: {
                    notify: true
                },
                dob: {
                    notify: true,
                    computed: 'changeDob(pickerDate)'
                },
                genderSelected: {
                    notify: true,
                    value: 0
                },
                gender: {
                    type: String,
                    notify: true
                },
                addline1: {
                    type: String,
                    notify: true
                },
                addline2: {
                    type: String,
                    notify: true
                },
                address: {
                    type: String,
                    notify: true
                },
                city: {
                    type: String,
                    notify: true
                },
                district: {
                    type: String,
                    notify: true
                },
                state: {
                    type: String,
                    notify: true
                },
                country: {
                    type: String,
                    notify: true
                },
                pincode: {
                    type: String,
                    notify: true
                },
                email: {
                    type: String,
                    notify: true
                },
                mobile: {
                    type: String,
                    notify: true
                },
                landline: {
                    type: String,
                    notify: true
                },
                schoolname: {
                    type: String,
                    notify: true
                },
                classSelected: {
                    type: Number,
                    value: 0,
                    notify: true
                },
                studClass: {
                    type: String,
                    value: '',
                    notify: true
                },
                stream: {
                    type: String,
                    value: '',
                    notify: true
                },
                aboutme: {
                    type: String,
                    value: '',
                    notify: true
                },
                error: {
                    type: String,
                    notify: true
                },
                studentupdate_Params: {
                    type: String,
                    notify: true
                },
                studentupdate_Params: {
                    type: String,
                    notify: true
                },
                studentGender: {
                    type: Array,
                    notify: true,
                    value: ["Male", "Female"]
                },
                studentClass: {
                    type: Array,
                    notify: true,
                    value: ["VIII", "IX", "X", "XI", "XII"]
                },
                check: {
                    type: Boolean,
                    notify: true,
                    value: false
                }
            },
            ready: function() {
                this.onLoad();
            },
            onLoad: function() {
                this.loginid = localStorage.loginid;
                this.batchid = localStorage.batchid;
                this.batchname = localStorage.batchname;
                if (this.check) {
                    this.setDefault();
                }
            },
            setDefault: function() {
                this.setStudentgetParams();
                this.getStudent();
            },
            opendatedialog: function() {
                this.$.pickDOB.open();
            },
            changeDob: function(pickerDate) {
                var fullDate = pickerDate.toDateString();
                fullDate = fullDate.split(" ");
                fullDate.splice(0, 1);
                fullDate = fullDate.toString().replace(",", " ");
                return fullDate;
            },
            onSubmit: function() {
                if (this.validateStudent()) {
                    this.setStudentUpdateParams();
                    this.setStudentUpdateBody();
                    this.updateStudent();
                }
            },
            validateStudent: function() {
                if (this.fname == null || this.fname == "") {
                    this.error = "First Name cannot be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.lname == null || this.lname == "") {
                    this.error = "Last Name cannot be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.imageurl == null || this.imageurl == "") {
                    this.error = "Please upload image";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.imageurl == null || this.imageurl == "") {
                    this.error = "Please upload image";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.pickerDate == null || this.pickerDate == "" || parseInt(new Date().getTime() - this.pickerDate.getTime()) < 24 * 60 * 60 * 1000) {
                    this.error = "Please select date of birth";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.addline1 == null || this.addline1 == "") {
                    this.error = "Address line can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.city == null || this.city == "") {
                    this.error = "City can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.district == null || this.district == "") {
                    this.error = "District can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.state == null || this.state == "") {
                    this.error = "State can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.country == null || this.country == "") {
                    this.error = "Country can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.pincode == null || this.pincode == "") {
                    this.error = "Pincode can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.email == null || this.email == "") {
                    this.error = "Email can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.email.indexOf('@') == -1) {
                    this.error = "Email Id is not valid";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.mobile == null || this.mobile == "") {
                    if (this.landline == null || this.landline == "") {
                        this.error = "Either enter Mobile number or Landline number";
                        this.$.errorDialog.open();
                        return false;
                    }
                } else if (this.schoolname == null || this.schoolname == "") {
                    this.error = "School can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.stream == null || this.stream == "") {
                    this.error = "Stream can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                } else if (this.aboutme == null || this.aboutme == "") {
                    this.error = "About me can't be left empty";
                    this.$.errorDialog.open();
                    return false;
                }
                return true;
            },
            setStudentUpdateParams: function() {
                var selObj = JSON.stringify({
                    loginid: localStorage.loginid
                });
                var retObj = {
                    where: selObj
                };
                this.studentupdate_Params = retObj;
            },
            setStudentUpdateBody: function() {
                var tempClass = this.studentClass[this.classSelected];
                var tempGender = this.studentGender[this.genderSelected];
                this.updatestudent_postbody = {
                    student_firstname: this.fname,
                    student_middlename: this.mname,
                    student_lastname: this.lname,
                    student_pic: this.imageurl,
                    student_dob: this.pickerDate,
                    student_gender: tempGender,
                    student_addressl1: this.addline1,
                    student_addressl2: this.addline2,
                    student_city: this.city,
                    student_district: this.district,
                    student_state: this.state,
                    student_country: this.country,
                    student_pincode: this.pincode,
                    student_emailid: this.email,
                    student_phoneno: this.mobile,
                    student_landlineno: this.landline,
                    student_school: this.schoolname,
                    student_class: tempClass,
                    student_stream: this.stream,
                    student_aboutme: this.aboutme
                };
            },
            updateStudent: function() {
                app.waitDialogMessage = "Please wait ..";
                app.$.commonWaitDialog.open();
                this.$.updatestudent_ironajax.generateRequest();

            },
            updateStudentOnResponse: function() {
                app.$.commonWaitDialog.close();
                localStorage.username = this.fname + " " + this.mname + " " + this.lname;
                localStorage.userimage = this.imageurl;
                if (!this.check)
                    window.location.assign('/app/dashboard/student');
                else {
                    app.username = localStorage.username;
                    app.userimage = localStorage.userimage;
                    app.$.toast.text = "Profile updated successfully.";
                    app.$.toast.show();
                }
            },
            updateStudentOnError: function() {
                app.$.commonWaitDialog.close();
                alert("Something went wrong please try again");
            },
            // Get student starts here
            setStudentgetParams: function() {
                var selObj = JSON.stringify({
                    "where": {
                        loginid: localStorage.loginid
                    }
                });
                var retObj = {
                    filter: selObj
                };
                this.studentget_Params = retObj;
            },
            getStudent: function() {
                app.waitDialogMessage = "Please wait ..";
                app.$.commonWaitDialog.open();
                this.$.studentget_ironajax.generateRequest();

            },
            getStudentOnResponse: function() {
                app.$.commonWaitDialog.close();
                var tempResponse = this.$.studentget_ironajax.lastResponse[0];
                var tempGender = "";
                var tempClass = "";
                this.fname = tempResponse.student_firstname;
                this.mname = tempResponse.student_middlename;
                this.lname = tempResponse.student_lastname;
                this.imageurl = tempResponse.student_pic;
                this.pickerDate = new Date(tempResponse.student_dob);
                tempGender = tempResponse.student_gender;
                this.addline1 = tempResponse.student_addressl1;
                this.addline2 = tempResponse.student_addressl2;
                this.city = tempResponse.student_city;
                this.district = tempResponse.student_district;
                this.state = tempResponse.student_state;
                this.country = tempResponse.student_country;
                this.pincode = tempResponse.student_pincode;
                this.email = tempResponse.student_emailid;
                this.mobile = tempResponse.student_phoneno;
                this.landline = tempResponse.student_landlineno;
                this.schoolname = tempResponse.student_school;
                tempClass = tempResponse.student_class;
                this.stream = tempResponse.student_stream;
                this.aboutme = tempResponse.student_aboutme;
                this.genderSelected = this.studentGender.indexOf(tempGender);
                this.classSelected = this.studentClass.indexOf(tempClass);
                this.fullname = this.fname + " " + this.mname + " " + this.lname;
                if (this.genderSelected == 0)
                    this.gender = "Male";
                else
                    this.gender = "Female";
                this.address = this.addline1 + ", " + this.addline2;
                this.studClass = this.studentClass[this.classSelected];
            },
            getStudentOnError: function() {
                app.$.commonWaitDialog.close();
                alert("Something went wrong please try again");
            },
            // Get student ends here
            openEditProfile: function() {
                page('/editprofile');
            },
            openImage: function() {
                this.$.image_dialog.open();
            }
        });
    })();
    </script>
</dom-module>
